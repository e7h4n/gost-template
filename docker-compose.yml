version: "3.9"

services:
  cloudflare-warp:
    image: e7h4n/cloudflare-warp
    restart: always
    volumes:
      - warp:/var/lib/cloudflare-warp/:rw

  cloudflare-ddns:
    image: oznu/cloudflare-ddns
    environment:
      - API_KEY=YOUR_CLOUDFLARE_API_TOKEN
      - ZONE=YOUR_MAIN_DOMAIN_WITHOUT_SUBDOMAIN_FOR_EXAMPLE_FACEBOOK_DOT_COM
      - SUBDOMAIN=YOUR_SUB_DOMAIN_WITHOUT_MAIN_DOMAIN_FOR_EXAMPLE_DOCS

  gost:
    image: gogost/gost
    depends_on:
      - certbot
    restart: always
    ports:
      - 8443:443
    volumes:
      - letsencrypt_data:/etc/letsencrypt/:ro
      - ./gost/:/etc/gost/:ro
    command:
      - -C=/etc/gost/config.yaml

  certbot:
    image: certbot/dns-cloudflare
    volumes:
      - letsencrypt_data:/etc/letsencrypt/:rw
      - ./gost/cloudflare.ini:/etc/cloudflare.ini:ro
    command:
      - certonly
      - --dns-cloudflare
      - --dns-cloudflare-credentials
      - /etc/cloudflare.ini
      - -m YOUR_CLOUDFLARE_MAIL_HERE
      - -d YOUR_FULL_DOMAIN_HERE_FOR_EXAMPLE_DOCS_DOT_FACEBOOK_DOT_COM
      - --agree-tos
      - --non-interactive

volumes:
  acme:
  warp:
  letsencrypt_data:
